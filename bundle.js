(()=>{"use strict";(()=>{let e;window.helpersModule={debounce:(t,n=500)=>{e&&window.clearTimeout(e),e=window.setTimeout(t,n)}}})(),window.backend={load:(e,t)=>{const n=new XMLHttpRequest;n.responseType="json",n.open("GET","https://21.javascript.pages.academy/code-and-magick/data"),n.addEventListener("load",(()=>{const o="";switch(n.status){case 200:e(n.response);break;case 400:o="Неверный запрос";break;case 401:o="Пользователь не авторизован";break;case 404:o="Ничего не найдено";break;default:o=`Cтатус ответа: : ${n.status} ${n.statusText}`}o&&t(o)})),n.addEventListener("error",(()=>{t("Произошла ошибка соединения")})),n.addEventListener("timeout",(()=>{t(`Запрос не успел выполниться за ${n.timeout} мс`)})),n.timeout=1e4,n.send()},save:(e,t,n)=>{const o=new XMLHttpRequest;o.responseType="json",o.addEventListener("load",(()=>{t(o.response)})),o.addEventListener("error",(()=>{n("Произошла ошибка соединения")})),o.addEventListener("timeout",(()=>{n(`Запрос не успел выполниться за ${o.timeout} мс`)})),o.timeout=1e4,o.open("POST","https://21.javascript.pages.academy/code-and-magick"),o.send(e)}},(()=>{const e=document.querySelector(".setup-similar-list"),t=document.querySelector("#similar-wizard-template").content.querySelector(".setup-similar-item");window.randNum=e=>Math.floor(Math.random()*e.length),window.coatColor="rgb(101, 137, 164)",window.eyesColor="black";let n=[];const o=e=>{let t=0;return e.colorCoat===window.coatColor&&(t+=2),e.colorEyes===window.eyesColor&&(t+=1),t},r=()=>{d(n.sort(((e,t)=>{let n=o(t)-o(e);return 0===n&&(n=e.name.localeCompare(t.name)),n})))},s=e=>{const n=t.cloneNode(!0);return n.querySelector(".setup-similar-label").textContent=e.name,n.querySelector(".wizard-coat").style.fill=e.colorCoat,n.querySelector(".wizard-eyes").style.fill=e.colorEyes,n},l=document.querySelector(".setup-similar-list"),d=t=>{const n=document.createDocumentFragment(),o=t.length>4?4:t.length;l.innerHTML="";for(let e=0;e<o;e++)n.appendChild(s(t[e]));e.appendChild(n),window.setup.querySelector(".setup-similar").classList.remove("hidden")},i=e=>{const t=document.createElement("div");t.style="z-index: 100; margin: 0 auto; text-align: center; background-color: red;",t.style.position="absolute",t.style.left=0,t.style.right=0,t.style.fontSize="30px",t.textContent=e,document.body.insertAdjacentElement("afterbegin",t)};window.backend.load((e=>{n=e,r()}),i),window.otherWizards={errorCreateWizards:i,updateWizards:r},document.querySelector(".setup-similar").classList.remove("hidden")})(),(()=>{window.setup=document.querySelector(".setup");const e=document.querySelector(".setup-open"),t=document.querySelector(".setup-close"),n=document.querySelector(".setup-user-name"),o=document.querySelector(".setup-wizard-form");n.addEventListener("focus",(()=>{document.removeEventListener("keydown",r)})),n.addEventListener("blur",(()=>{document.addEventListener("keydown",r)}));const r=e=>{"Escape"===e.key&&(e.preventDefault(),window.setup.classList.add("hidden"))},s=()=>{window.setup.classList.remove("hidden"),window.setup.style.top="80px",window.setup.style.left="50%",document.addEventListener("keydown",r)},l=()=>{window.setup.classList.add("hidden"),document.removeEventListener("keydown",r)};e.addEventListener("click",(()=>{s()})),e.addEventListener("keydown",(e=>{"Enter"===e.key&&s()})),t.addEventListener("click",(()=>{l()})),t.addEventListener("keydown",(e=>{"Enter"===e.key&&l()})),o.addEventListener("submit",(e=>{window.backend.save(new FormData(o),(()=>{window.setup.classList.add("hidden")}),window.otherWizards.errorCreateWizards),e.preventDefault()}))})(),(()=>{const e=document.querySelector(".setup-fireball-wrap"),t=document.querySelector('input[name="coat-color"]'),n=document.querySelector('input[name="eyes-color"]'),o=e.querySelector('input[name="fireball-color"]'),r=document.querySelector(".wizard-coat");let s=["rgb(101, 137, 164)","rgb(241, 43, 107)","rgb(146, 100, 161)","rgb(56, 159, 117)","rgb(215, 210, 55)","rgb(0, 0, 0)"];const l=e=>e.splice(window.randNum(e),1).pop();r.addEventListener("click",(()=>{s[0]&&!s[1]&&(s=["rgb(101, 137, 164)","rgb(241, 43, 107)","rgb(146, 100, 161)","rgb(56, 159, 117)","rgb(215, 210, 55)","rgb(0, 0, 0)"]);const e=l(s);r.style.fill=e,t.value=e,window.coatColor=e,window.helpersModule.debounce(window.otherWizards.updateWizards)}));const d=document.querySelector(".wizard-eyes");let i=["black","red","blue","yellow","green"];d.addEventListener("click",(()=>{i[0]&&!i[1]&&(i=["black","red","blue","yellow","green"]);const e=l(i);d.style.fill=e,n.value=e,window.eyesColor=e,window.helpersModule.debounce(window.otherWizards.updateWizards)}));let a=["#ee4830","#30a8ee","#5ce6c0","#e848d5","#e6e848"];e.addEventListener("click",(()=>{a[0]&&!a[1]&&(a=["#ee4830","#30a8ee","#5ce6c0","#e848d5","#e6e848"]);const t=l(a);e.style.backgroundColor=t,o.value=t}))})(),(()=>{const e=document.querySelector(".upload");e.addEventListener("mousedown",(t=>{t.preventDefault();let n={x:t.clientX,y:t.clientY},o=!1;const r=e=>{e.preventDefault();let t=n.x-e.clientX,r=n.y-e.clientY;n={x:e.clientX,y:e.clientY},o=!0,window.setup.style.top=window.setup.offsetTop-r+"px",window.setup.style.left=window.setup.offsetLeft-t+"px"},s=t=>{if(t.preventDefault(),document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",s),o){const t=n=>{n.preventDefault(),e.removeEventListener("click",t)};e.addEventListener("click",t)}};document.addEventListener("mousemove",r),document.addEventListener("mouseup",s)}))})(),(()=>{const e=["hsl(240, 20%, 50%)","hsl(240, 50%, 50%)","hsl(240, 70%, 50%)","hsl(240, 100%, 50%)"],t=(e,t,n,o)=>{e.fillStyle=o,e.fillRect(t,n,420,270)};window.renderStatistics=(n,o,r)=>{t(n,110,20,"rgba(0, 0, 0, 0.7)"),t(n,100,10,"#fff"),n.fillStyle="#000",n.font="16px PT Mono",n.textBaseline="hanging",n.fillText("Ура вы победили!",120,30),n.fillText("Список результатов:",120,45);const s=(e=>{let t=e[0];for(let n=1;n<e.length;n++)e[n]>t&&(t=e[n]);return t})(r);for(let t=0;t<o.length;t++){n.fillStyle="#000",n.fillText(o[t],150+90*t,260),"Вы"===o[t]?n.fillStyle="rgba(255, 0, 0, 1)":n.fillStyle=e[t];const l=150*r[t]/s;n.fillRect(150+90*t,270-l-10-15,40,l),n.fillStyle="#000",n.fillText(r[t].toFixed(),150+90*t,270-l-50)}}})()})();